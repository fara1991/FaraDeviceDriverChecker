<Window x:Class="FaraDeviceDriverChecker.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:vm="clr-namespace:FaraDeviceDriverChecker.Wpf.ViewModels"
        mc:Ignorable="d"
        Title="FaraDeviceDriverChecker" Height="650" Width="950"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource MaterialDesign.Brush.Background}"
        TextElement.Foreground="{DynamicResource MaterialDesign.Brush.Foreground}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        FontFamily="{DynamicResource MaterialDesignFont}">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>

    <materialDesign:DialogHost>
        <Grid>
            <!-- メインコンテンツ -->
            <Grid Margin="16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- ヘッダー -->
                <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Devices" Width="32" Height="32" VerticalAlignment="Center"
                                                     Foreground="{DynamicResource PrimaryHueMidBrush}" />
                            <TextBlock Text="デバイスドライバーチェッカー" FontSize="20" FontWeight="Bold"
                                       VerticalAlignment="Center" Margin="12,0,0,0" />
                        </StackPanel>

                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <ComboBox Width="180"
                                      ItemsSource="{Binding Categories}"
                                      SelectedItem="{Binding SelectedCategory}"
                                      DisplayMemberPath="Name"
                                      IsEnabled="{Binding IsNotLoading}"
                                      materialDesign:HintAssist.Hint="カテゴリを選択"
                                      Style="{StaticResource MaterialDesignOutlinedComboBox}" />
                        </StackPanel>
                    </Grid>
                </materialDesign:Card>

                <!-- アクションボタン -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,16">
                    <Button Command="{Binding ScanCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Magnify" VerticalAlignment="Center" />
                            <TextBlock Text="スキャン" Margin="8,0,0,0" VerticalAlignment="Center" />
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding CheckUpdatesCommand}"
                            Style="{StaticResource MaterialDesignRaisedSecondaryButton}"
                            Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Update" VerticalAlignment="Center" />
                            <TextBlock Text="更新を確認" Margin="8,0,0,0" VerticalAlignment="Center" />
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding RunUpdateCommand}"
                            Style="{StaticResource MaterialDesignRaisedDarkButton}"
                            Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Download" VerticalAlignment="Center" />
                            <TextBlock Text="Windows Update実行" Margin="8,0,0,0" VerticalAlignment="Center" />
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding OpenSettingsCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Cog" VerticalAlignment="Center" />
                            <TextBlock Text="設定を開く" Margin="8,0,0,0" VerticalAlignment="Center" />
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- デバイス一覧 -->
                <materialDesign:Card Grid.Row="2" Padding="0">
                    <DataGrid ItemsSource="{Binding Devices}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              HeadersVisibility="Column"
                              GridLinesVisibility="Horizontal"
                              BorderThickness="0">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="状態" Width="50">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <materialDesign:PackIcon Width="24" Height="24" HorizontalAlignment="Center">
                                            <materialDesign:PackIcon.Style>
                                                <Style TargetType="materialDesign:PackIcon">
                                                    <Setter Property="Kind" Value="CheckCircle" />
                                                    <Setter Property="Foreground" Value="Green" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HasProblem}" Value="True">
                                                            <Setter Property="Kind" Value="AlertCircle" />
                                                            <Setter Property="Foreground" Value="Red" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </materialDesign:PackIcon.Style>
                                        </materialDesign:PackIcon>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="デバイス名" Binding="{Binding Name}" Width="*" />
                            <DataGridTextColumn Header="製造元" Binding="{Binding Manufacturer}" Width="120" />
                            <DataGridTextColumn Header="クラス" Binding="{Binding Class}" Width="100" />
                            <DataGridTextColumn Header="バージョン" Binding="{Binding DriverVersion}" Width="100" />
                            <DataGridTextColumn Header="日付" Binding="{Binding DriverDate}" Width="90" />
                            <DataGridTextColumn Header="詳細" Binding="{Binding StatusDisplay}" Width="180">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding HasProblem}" Value="True">
                                                <Setter Property="Foreground" Value="Red" />
                                                <Setter Property="FontWeight" Value="Bold" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </materialDesign:Card>

                <!-- 利用可能な更新 -->
                <Expander Grid.Row="3" Header="利用可能なドライバー更新" Margin="0,16,0,0"
                          Visibility="{Binding AvailableUpdates.Count, Converter={StaticResource BoolToVis}}"
                          Background="{DynamicResource MaterialDesign.Brush.Card.Background}">
                    <ListBox ItemsSource="{Binding AvailableUpdates}" MaxHeight="120" />
                </Expander>

                <!-- ステータスバー -->
                <materialDesign:Card Grid.Row="4" Padding="12" Margin="0,16,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <ProgressBar Grid.Column="0" Width="24" Height="24"
                                     Style="{StaticResource MaterialDesignCircularProgressBar}"
                                     IsIndeterminate="True"
                                     Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}"
                                     Margin="0,0,12,0" />

                        <TextBlock Grid.Column="1" Text="{Binding StatusMessage}" VerticalAlignment="Center" />
                    </Grid>
                </materialDesign:Card>
            </Grid>

            <!-- ローディングオーバーレイ -->
            <Grid Background="#80000000" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                 IsIndeterminate="True" Width="50" Height="50" />
                    <TextBlock Text="処理中..." Foreground="White" Margin="0,16,0,0"
                               FontSize="16" HorizontalAlignment="Center" />
                </StackPanel>
            </Grid>
        </Grid>
    </materialDesign:DialogHost>
</Window>

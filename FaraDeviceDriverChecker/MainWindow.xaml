<Window x:Class="FaraDeviceDriverChecker.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:vm="clr-namespace:FaraDeviceDriverChecker.ViewModels"
        mc:Ignorable="d"
        Title="FaraDeviceDriverChecker" Height="650" Width="1050"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource MaterialDesign.Brush.Background}"
        TextElement.Foreground="{DynamicResource MaterialDesign.Brush.Foreground}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        FontFamily="{DynamicResource MaterialDesignFont}">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>

    <materialDesign:DialogHost>
        <Grid>
            <!-- メインコンテンツ -->
            <Grid Margin="16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- ヘッダー -->
                <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Devices" Width="32" Height="32" VerticalAlignment="Center"
                                                     Foreground="{DynamicResource PrimaryHueMidBrush}" />
                            <TextBlock Text="デバイスドライバーチェッカー" FontSize="20" FontWeight="Bold"
                                       VerticalAlignment="Center" Margin="12,0,0,0" />
                        </StackPanel>

                        <Button Grid.Column="1" Command="{Binding OpenSettingsCommand}"
                                Style="{StaticResource MaterialDesignOutlinedButton}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Cog" VerticalAlignment="Center" />
                                <TextBlock Text="設定を開く" Margin="8,0,0,0" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>
                    </Grid>
                </materialDesign:Card>

                <!-- メインエリア -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="180" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- カテゴリリスト -->
                    <materialDesign:Card Grid.Column="0" Padding="8" Margin="0,0,16,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="カテゴリ" FontWeight="Bold" Margin="8,0,0,8" />

                            <StackPanel Grid.Row="1">
                                <CheckBox Content="すべて"
                                          IsChecked="{Binding IsAllSelected}"
                                          IsEnabled="{Binding IsNotLoading}"
                                          Margin="0,4"
                                          FontWeight="Bold"
                                          Style="{StaticResource MaterialDesignCheckBox}" />
                                <Separator Margin="0,4" />
                                <ItemsControl ItemsSource="{Binding Categories}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <CheckBox Content="{Binding Name}"
                                                      IsChecked="{Binding IsSelected}"
                                                      IsEnabled="{Binding DataContext.IsNotLoading, RelativeSource={RelativeSource AncestorType=Window}}"
                                                      Margin="0,4"
                                                      Style="{StaticResource MaterialDesignCheckBox}" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>

                            <StackPanel Grid.Row="2" Margin="0,8,0,0">
                                <Button Command="{Binding ScanCommand}"
                                        Style="{StaticResource MaterialDesignRaisedButton}"
                                        Margin="0,0,0,8">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Magnify" VerticalAlignment="Center" />
                                        <TextBlock Text="スキャン" Margin="8,0,0,0" VerticalAlignment="Center" />
                                    </StackPanel>
                                </Button>
                                <Button Command="{Binding RunUpdateCommand}"
                                        Style="{StaticResource MaterialDesignRaisedDarkButton}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Download" VerticalAlignment="Center" />
                                        <TextBlock Text="Updateを実行" Margin="8,0,0,0" VerticalAlignment="Center" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </materialDesign:Card>

                    <!-- デバイス一覧 -->
                    <materialDesign:Card Grid.Column="1" Padding="0">
                    <DataGrid ItemsSource="{Binding Devices}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              HeadersVisibility="Column"
                              GridLinesVisibility="Horizontal"
                              BorderThickness="0">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="状態" Width="70">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <materialDesign:PackIcon Width="24" Height="24" HorizontalAlignment="Center">
                                            <materialDesign:PackIcon.Style>
                                                <Style TargetType="materialDesign:PackIcon">
                                                    <Setter Property="Kind" Value="CheckCircle" />
                                                    <Setter Property="Foreground" Value="Green" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HasProblem}" Value="True">
                                                            <Setter Property="Kind" Value="AlertCircle" />
                                                            <Setter Property="Foreground" Value="Red" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </materialDesign:PackIcon.Style>
                                        </materialDesign:PackIcon>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="デバイス名" Binding="{Binding Name}" Width="*">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="製造元" Binding="{Binding Manufacturer}" Width="150">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="クラス" Binding="{Binding Class}" Width="120">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="バージョン" Binding="{Binding DriverVersion}" Width="120">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="日付" Binding="{Binding DriverDate}" Width="120">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </materialDesign:Card>
                </Grid>

                <!-- ステータスバー -->
                <materialDesign:Card Grid.Row="2" Padding="12" Margin="0,16,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <ProgressBar Grid.Column="0" Width="24" Height="24"
                                     Style="{StaticResource MaterialDesignCircularProgressBar}"
                                     IsIndeterminate="True"
                                     Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}"
                                     Margin="0,0,12,0" />

                        <TextBlock Grid.Column="1" Text="{Binding StatusMessage}" VerticalAlignment="Center" />
                    </Grid>
                </materialDesign:Card>
            </Grid>

            <!-- ローディングオーバーレイ -->
            <Grid Background="#80000000" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                 IsIndeterminate="True" Width="50" Height="50" />
                    <TextBlock Text="処理中..." Foreground="White" Margin="0,16,0,0"
                               FontSize="16" HorizontalAlignment="Center" />
                </StackPanel>
            </Grid>
        </Grid>
    </materialDesign:DialogHost>
</Window>
